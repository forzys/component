function t(t,e,n,i){return new(n||(n=Promise))((function(o,s){function l(t){try{r(i.next(t))}catch(t){s(t)}}function a(t){try{r(i.throw(t))}catch(t){s(t)}}function r(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,a)}r((i=i.apply(t,e||[])).next())}))}var e={name:"tiny-player",version:"1.0.12",description:"",type:"module",types:"./dist/types/index.d.ts",browser:"./dist/index.min.js",module:"./dist/index.js",files:["dist","package.json"],scripts:{dev:"rollup -c -w","dev-w":"cross-env IS_DEV=true node ./custom-dev.js",build:"rollup -c"},homepage:"https://tiny-player.vercel.app",repository:{type:"git",url:"https://github.com/wangrongding/tiny-player"},keywords:["player","video","mp4","hls","flv","m3u8"],author:"è£é¡¶",license:"MIT",devDependencies:{"@rollup/plugin-alias":"^5.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.2",chokidar:"^3.5.3","cross-env":"^7.0.3","hls.js":"^1.4.5",rollup:"^3.20.6","rollup-plugin-delete":"^2.0.0","rollup-plugin-ejs":"^4.0.0","rollup-plugin-scss":"^4.0.0","rollup-plugin-serve":"^2.0.2","rollup-plugin-svg-import":"^2.0.0","rollup-plugin-terser":"^7.0.2","rollup-plugin-typescript2":"^0.34.1",tslib:"^2.5.2",typescript:"^5.0.4"},peerDependencies:{"hls.js":"^1.4.5"}};!function(t){if(!t)return;if("undefined"==typeof window)return;const e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e)}(".tp-watermark {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-size: 100%;\n  pointer-events: none; }\n\n.tp-hide-controller .tp-control-panel {\n  display: none; }\n\n.tp-control-panel {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  bottom: 0;\n  left: 0; }\n  .tp-control-panel .tp-play-icon,\n  .tp-control-panel .tp-loading {\n    color: white;\n    cursor: pointer;\n    overflow: hidden;\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    box-sizing: border-box;\n    display: grid;\n    place-content: center; }\n    .tp-control-panel .tp-play-icon svg,\n    .tp-control-panel .tp-loading svg {\n      width: 50px;\n      height: 50px; }\n\n@keyframes tp-loading {\n  0% {\n    transform: rotate(0deg); }\n  100% {\n    transform: rotate(360deg); } }\n  .tp-control-panel .tp-loading {\n    pointer-events: none;\n    background-color: rgba(255, 255, 255, 0.4); }\n    .tp-control-panel .tp-loading svg {\n      animation: tp-loading 1s infinite;\n      width: 40px;\n      height: 40px; }\n  .tp-control-panel .tp-control-bar {\n    position: absolute;\n    bottom: 0px;\n    left: 0;\n    width: 100%;\n    height: 35px;\n    user-select: none;\n    transition: all 0.3s ease;\n    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.25), rgba(0, 0, 0, 0.4));\n    color: white;\n    padding: 0 10px;\n    box-sizing: border-box;\n    display: flex;\n    gap: 8px;\n    justify-content: space-between;\n    align-items: center; }\n    .tp-control-panel .tp-control-bar .tp-seek-slider {\n      width: 100%;\n      flex: 1; }\n    .tp-control-panel .tp-control-bar .tp-volume-bar {\n      width: 80px;\n      display: flex;\n      justify-content: space-between;\n      align-items: center; }\n    .tp-control-panel .tp-control-bar .tp-volume-icon,\n    .tp-control-panel .tp-control-bar .tp-fullscreen {\n      display: inline-block;\n      width: 20px;\n      height: 20px;\n      text-align: center;\n      color: white; }\n    .tp-control-panel .tp-control-bar .tp-volume-slider {\n      width: 60px; }\n    .tp-control-panel .tp-control-bar .tp-play-time {\n      font-family: Menlo, Courier New, Consolas, Lucida Console, Courier, monospace;\n      font-size: 14px;\n      text-align: center;\n      user-select: none;\n      min-width: 120px; }\n    .tp-control-panel .tp-control-bar .tp-play-time-tip {\n      display: none;\n      width: 50px;\n      text-align: center;\n      position: absolute;\n      top: -30px;\n      left: -10px;\n      pointer-events: none;\n      background-color: #000;\n      color: #fff;\n      padding: 5px;\n      border-radius: 4px;\n      font-size: 14px; }\n      .tp-control-panel .tp-control-bar .tp-play-time-tip::after {\n        content: '';\n        position: absolute;\n        top: 100%;\n        left: 50%;\n        transform: translateX(-50%);\n        border-width: 6px;\n        border-style: solid;\n        border-color: #000 transparent transparent transparent; }\n\n.tp-control-bar input[type='range'] {\n  height: 20px;\n  -webkit-appearance: none;\n  appearance: none;\n  background: transparent;\n  margin: 10px 0;\n  cursor: pointer; }\n  .tp-control-bar input[type='range']:focus {\n    outline: none; }\n  .tp-control-bar input[type='range']::-webkit-slider-runnable-track {\n    width: 100%;\n    height: 4px;\n    box-shadow: 0px 0px 0px #000000;\n    background: #d3d3d3;\n    border-radius: 1px;\n    border: 0px solid #000000; }\n  .tp-control-bar input[type='range']::-moz-range-track {\n    width: 100%;\n    height: 4px;\n    box-shadow: 0px 0px 0px #000000;\n    background: #d3d3d3;\n    border-radius: 1px;\n    border: 0px solid #000000; }\n  .tp-control-bar input[type='range']::-ms-track {\n    width: 100%;\n    height: 4px;\n    box-shadow: 0px 0px 0px #000000;\n    background: #d3d3d3;\n    border-radius: 1px;\n    border: 0px solid #000000; }\n  .tp-control-bar input[type='range']::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    box-shadow: 0px 0px 0px #000000;\n    border: 1px solid #0163a5;\n    height: 12px;\n    width: 12px;\n    border-radius: 20px;\n    margin-top: -4px;\n    background-color: #fff;\n    border: 1px solid transparent;\n    border-image: linear-gradient(#fff, #fff) 0 fill/4 12 4 0/0px 0px 0 3000px; }\n  .tp-control-bar input[type='range']::-moz-range-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    box-shadow: 0px 0px 0px #000000;\n    border: 1px solid #0163a5;\n    height: 12px;\n    width: 12px;\n    border-radius: 20px;\n    margin-top: -4px;\n    background-color: #fff;\n    border: 1px solid transparent;\n    border-image: linear-gradient(#fff, #fff) 0 fill/4 12 4 0/0px 0px 0 3000px; }\n  .tp-control-bar input[type='range']::-ms-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    box-shadow: 0px 0px 0px #000000;\n    border: 1px solid #0163a5;\n    height: 12px;\n    width: 12px;\n    border-radius: 20px;\n    margin-top: -4px;\n    background-color: #fff;\n    border: 1px solid transparent;\n    border-image: linear-gradient(#fff, #fff) 0 fill/4 12 4 0/0px 0px 0 3000px; }\n  .tp-control-bar input[type='range']::-webkit-slider-container {\n    overflow: hidden; }\n\n.tp-container {\n  position: relative;\n  overflow: hidden; }\n\n.tp-video {\n  width: 100%;\n  height: 100%;\n  transform: translate(0px, 0px); }\n");const n='<svg viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M44.14 11.437a23.03 23.03 0 00-16.352-6.77 23.025 23.025 0 00-16.347 6.77 22.992 22.992 0 00-4.956 7.352 22.963 22.963 0 00-1.818 9c0 3.122.61 6.152 1.818 9.004a22.976 22.976 0 004.956 7.348 22.996 22.996 0 007.348 4.955 22.963 22.963 0 009 1.819 22.96 22.96 0 009.004-1.819 23.037 23.037 0 007.348-4.955 22.976 22.976 0 004.955-7.348 22.967 22.967 0 001.819-9.004c0-3.119-.611-6.148-1.819-9a22.992 22.992 0 00-4.955-7.352z" stroke-opacity=".6" stroke="#FFF" fill="#1B2337" opacity=".6"/><path d="M23.524 37.109a1.68 1.68 0 01-1.684 0 1.683 1.683 0 01-.84-1.456V20.349c0-.6.32-1.158.84-1.456a1.68 1.68 0 011.684 0l13.251 7.65a1.684 1.684 0 010 2.914L23.524 37.11z" fill="#FFF"/></g></svg>',i='<svg viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M49.498 18.917a23.2 23.2 0 00-5-7.419 23.238 23.238 0 00-16.5-6.832 23.234 23.234 0 00-16.496 6.832 23.2 23.2 0 00-5 7.419 23.17 23.17 0 00-1.835 9.081c0 3.15.616 6.208 1.835 9.085a23.184 23.184 0 005 7.415 23.204 23.204 0 007.415 5 23.17 23.17 0 009.081 1.835c3.15 0 6.208-.616 9.085-1.835a23.245 23.245 0 007.415-5 23.184 23.184 0 005-7.415 23.175 23.175 0 001.835-9.085 23.17 23.17 0 00-1.835-9.081" stroke-opacity=".6" stroke="#FFF" fill="#1B2337" opacity=".6"/><path d="M21.467 37.333V18.667h4.2v18.666h-4.2zm13.066-18.666v18.666h-4.2V18.667h4.2z" fill="#FFF"/></g></svg>',o='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="white"><path d="M13.728 6.272v19.456q0 .448-.352.8t-.8.32-.8-.32l-5.952-5.952H1.152q-.48 0-.8-.352t-.352-.8v-6.848q0-.48.352-.8t.8-.352h4.672l5.952-5.952q.32-.32.8-.32t.8.32.352.8zM20.576 16q0 1.344-.768 2.528t-2.016 1.664q-.16.096-.448.096-.448 0-.8-.32t-.32-.832q0-.384.192-.64t.544-.448.608-.384.512-.64.192-1.024-.192-1.024-.512-.64-.608-.384-.544-.448-.192-.64q0-.48.32-.832t.8-.32q.288 0 .448.096 1.248.48 2.016 1.664T20.576 16zm4.576 0q0 2.72-1.536 5.056t-4 3.36q-.256.096-.448.096-.48 0-.832-.352t-.32-.8q0-.704.672-1.056 1.024-.512 1.376-.8 1.312-.96 2.048-2.4T22.848 16t-.736-3.104-2.048-2.4q-.352-.288-1.376-.8-.672-.352-.672-1.056 0-.448.32-.8t.8-.352q.224 0 .48.096 2.496 1.056 4 3.36T25.152 16z"/></svg>',s='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="white"><path d="M13.728 6.272v19.456q0 .448-.352.8t-.8.32-.8-.32l-5.952-5.952H1.152q-.48 0-.8-.352t-.352-.8v-6.848q0-.48.352-.8t.8-.352h4.672l5.952-5.952q.32-.32.8-.32t.8.32.352.8zM20.576 16q0 1.344-.768 2.528t-2.016 1.664q-.16.096-.448.096-.448 0-.8-.32t-.32-.832q0-.384.192-.64t.544-.448.608-.384.512-.64.192-1.024-.192-1.024-.512-.64-.608-.384-.544-.448-.192-.64q0-.48.32-.832t.8-.32q.288 0 .448.096 1.248.48 2.016 1.664T20.576 16z"/></svg>',l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="white"><path d="M13.728 6.272v19.456q0 .448-.352.8t-.8.32-.8-.32l-5.952-5.952H1.152q-.48 0-.8-.352t-.352-.8v-6.848q0-.48.352-.8t.8-.352h4.672l5.952-5.952q.32-.32.8-.32t.8.32.352.8z"/></svg>',a='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 33" fill="white"><path d="M24.965 24.38H6.833a2.482 2.482 0 01-2.478-2.478V10.096a2.482 2.482 0 012.478-2.478h18.132a2.482 2.482 0 012.478 2.478v11.806a2.481 2.481 0 01-2.478 2.478zM6.833 10.097v11.806h18.134l-.002-11.806H6.833zM2.478 28.928H8.43a1.238 1.238 0 100-2.477H2.478v-5.802a1.239 1.239 0 10-2.477 0v5.802a2.481 2.481 0 002.478 2.478zm28.283-9.516c-.684 0-1.238.554-1.238 1.238v5.801h-5.951a1.237 1.237 0 100 2.477h5.951a2.48 2.48 0 002.478-2.478v-5.801c0-.683-.554-1.238-1.239-1.238zM0 5.55v5.802a1.238 1.238 0 002.476 0V5.55h5.952a1.238 1.238 0 100-2.476H2.477A2.48 2.48 0 00-.001 5.55zm32 5.8V5.549a2.48 2.48 0 00-2.478-2.478h-5.951a1.237 1.237 0 100 2.476h5.951v5.801c0 .683.554 1.237 1.238 1.237a1.235 1.235 0 001.239-1.236z"/></svg>',r='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"/></svg>';const p=(t,e)=>{let n=null;return(...i)=>{n||(n=setTimeout((()=>{t(...i),n=null}),e))}},h=(t,e)=>{const n=Math.pow(10,null!=e?e:0);if(t<59.9)return`${t.toFixed(1)}s`;const i=Math.floor(t/60),o=Math.floor(t%60*n)/n;return`${i}:${o<10?`0${o}`:o}`},d=/mobile/i.test(window.navigator.userAgent),c=t=>{if(0===(t=t||0)||t===1/0||"NaN"===t.toString())return"00:00";const e=Math.floor(t/3600),n=Math.floor((t-3600*e)/60),i=Math.floor(t-3600*e-60*n);return(e>0?[e,n,i]:[n,i]).map((t=>t<10?"0"+t:""+t)).join(":")};class u{constructor(t){this.disableAutoHide=!1,this.playRaf=0,this.initControls=()=>{this.controlElement=document.createElement("div"),this.controlElement.className="tp-control-panel",this.controlElement.innerHTML=function(t,e,n,i){i=i||function(t,e,n,i,o){var s=e.split("\n"),l=Math.max(i-3,0),a=Math.min(s.length,i+3),r=o(n),p=s.slice(l,a).map((function(t,e){var n=e+l+1;return(n==i?" >> ":"    ")+n+"| "+t})).join("\n");throw t.path=r,t.message=(r||"ejs")+":"+i+"\n"+p+"\n\n"+t.message,t},e=e||function(t){return null==t?"":String(t).replace(s,l)};var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},s=/[&<>'"]/g;function l(t){return o[t]||t}var a=1;try{var r="";function p(t){null!=t&&(r+=t)}return p('\x3c!-- æ§åˆ¶é¢æ¿ --\x3e\n\n\x3c!-- æ’­æ”¾æŒ‰é’® --\x3e\n<div class="tp-play-icon"></div>\n\x3c!-- åº•éƒ¨æ§åˆ¶æ  --\x3e\n<div class="tp-control-bar">\n  \x3c!-- è¿›åº¦æ¡ --\x3e\n  <input type="range" class="tp-seek-slider" min="0" max="100" step="any" value="0" />\n  <span class="tp-play-time-tip">0.0s</span>\n\n  \x3c!-- æ’­æ”¾æ—¶é—´ --\x3e\n  '),a=12,t.playTime&&(p('\n  <span class="tp-play-time">00:00 / 00:00</span>\n  '),a=14),p("\n\n  \x3c!-- éŸ³é‡æ§åˆ¶ --\x3e\n  "),a=17,t.volumeControl&&(p('\n  <div class="tp-volume-bar">\n    <i class="tp-volume-icon"></i>\n    <input type="range" class="tp-volume-slider" min="0" max="1" step="0.01" value="'),a=20,p(e(t.volume)),p('" />\n  </div>\n  '),a=22),p("\n\n  \x3c!-- å…¨å± --\x3e\n  "),a=25,t.fullScreenControl&&(p('\n  <i class="tp-fullscreen"></i>\n  '),a=27),p('\n</div>\n\x3c!-- åŠ è½½åŠ¨ç”» --\x3e\n<div class="tp-loading"></div>\n'),a=31,r}catch(h){i(h,'\x3c!-- æ§åˆ¶é¢æ¿ --\x3e\n\n\x3c!-- æ’­æ”¾æŒ‰é’® --\x3e\n<div class="tp-play-icon"></div>\n\x3c!-- åº•éƒ¨æ§åˆ¶æ  --\x3e\n<div class="tp-control-bar">\n  \x3c!-- è¿›åº¦æ¡ --\x3e\n  <input type="range" class="tp-seek-slider" min="0" max="100" step="any" value="0" />\n  <span class="tp-play-time-tip">0.0s</span>\n\n  \x3c!-- æ’­æ”¾æ—¶é—´ --\x3e\n  <% if(locals.playTime){ %>\n  <span class="tp-play-time">00:00 / 00:00</span>\n  <% } %>\n\n  \x3c!-- éŸ³é‡æ§åˆ¶ --\x3e\n  <% if(locals.volumeControl){ %>\n  <div class="tp-volume-bar">\n    <i class="tp-volume-icon"></i>\n    <input type="range" class="tp-volume-slider" min="0" max="1" step="0.01" value="<%= locals.volume %>" />\n  </div>\n  <% } %>\n\n  \x3c!-- å…¨å± --\x3e\n  <% if(locals.fullScreenControl){ %>\n  <i class="tp-fullscreen"></i>\n  <% } %>\n</div>\n\x3c!-- åŠ è½½åŠ¨ç”» --\x3e\n<div class="tp-loading"></div>\n',void 0,a,e)}}(Object.assign(Object.assign({},this.player.options.controlOptions||{}),{volume:this.player.options.volume})),!this.controlOptions.manualMount&&!this.controlOptions.nativeControls&&this.mountTarget.appendChild(this.controlElement),this.loading=this.controlElement.querySelector(".tp-loading"),this.loading.innerHTML=r,this.loading.style.opacity="0",this.bottomControlBar=this.controlElement.querySelector(".tp-control-bar"),this.bottomControlBar.addEventListener("mousedown",(t=>t.stopPropagation())),this.initPlayButton(),this.initSeekBar(),this.initVolumeButton(),this.initFullScreenButton()},this.initPlayButton=()=>{this.playButton=this.controlElement.querySelector(".tp-play-icon"),this.playButton.innerHTML=n,this.playButton.addEventListener("click",this.player.togglePlay)},this.initSeekBar=()=>{this.seekBar=this.controlElement.querySelector(".tp-seek-slider");let t=!1;const e=e=>{e.stopPropagation(),t=!this.player.video.paused,this.player.pause()},n=e=>{e.stopPropagation(),t&&this.player.play()};this.seekBar.addEventListener("mousedown",e),this.seekBar.addEventListener("mouseup",n),this.seekBar.addEventListener("touchstart",e),this.seekBar.addEventListener("touchend",n),this.seekBar.addEventListener("touchmove",(t=>t.stopPropagation())),this.seekBar.addEventListener("input",this.onSeeking),this.playTime=this.controlElement.querySelector(".tp-play-time")},this.initVolumeButton=()=>{const t=this.player.options.volume?this.player.options.volume>1?this.player.options.volume/100:this.player.options.volume:1;this.player.video.volume=t,this.controlOptions.volumeControl&&(this.muteButton=this.controlElement.querySelector(".tp-volume-icon"),this.muteButton.addEventListener("click",this.player.mute),this.switchVolumeIcon(),this.volumeSlider=this.controlElement.querySelector(".tp-volume-slider"),this.volumeSlider.addEventListener("input",p(this.onVolumeChange,100)),this.volumeControlBar=this.controlElement.querySelector(".tp-volume-bar"))},this.initFullScreenButton=()=>{this.fullScreenButton=this.controlElement.querySelector(".tp-fullscreen"),this.fullScreenButton&&(this.fullScreenButton.addEventListener("click",this.player.toggleFullScreen),this.fullScreenButton.innerHTML=a)},this.watchControlResize=()=>{new ResizeObserver(p((t=>{for(const e of t){if(!e.contentBoxSize)return;const{inlineSize:t,blockSize:n}=e.contentBoxSize[0];this.playButton.style.display=n<40||t<40?"none":"grid",this.bottomControlBar.style.display=n<75||t<60?"none":"flex",this.playButton.style.scale=n<100||t<100?"0.5":"1",this.fullScreenButton&&t<200?this.fullScreenButton.style.display="none":this.fullScreenButton&&(this.fullScreenButton.style.display="block"),this.playTime&&t<330?this.playTime.style.display="none":this.playTime&&(this.playTime.style.display="block"),this.volumeControlBar&&t<400?this.volumeControlBar.style.display="none":this.volumeControlBar&&(this.volumeControlBar.style.display="flex")}}),30)).observe(this.controlElement)},this.initControlsEvent=()=>{this.player.on("waiting",this.onWaiting),this.player.on("timeupdate",this.onTimeupdate),this.player.on("playing",this.onPlaying),this.player.on("canplay",(()=>this.toggleLoading(!1))),this.player.on("seeked",(()=>this.onSeeked)),this.player.on("loadedmetadata",this.initTimeTip),this.player.on("pause",this.setAutoHide),this.player.on("play",this.setAutoHide),this.initMountTargetEvent(),this.watchControlResize()},this.initTimeTip=()=>{const t=this.controlElement.querySelector(".tp-play-time-tip"),e=this.player.duration;let n=!1,i=!1;this.seekBar.addEventListener("input",(o=>{const s=o.target;t.textContent=h(+s.value/100*e),d&&n&&!i&&(t.style.display="block")}));const o=o=>{const s=this.seekBar.clientWidth;let l=0;if(o instanceof MouseEvent){t.style.display="block",l=o.offsetX;const n=l/s*e;t.textContent=h(n)}if(o instanceof TouchEvent){const t=o.touches[0];let e=o.target.getBoundingClientRect();l=t.clientX-e.left,n=!0}(l<0||l>s)&&(t.style.display="none",i=!0),i=!1,t.style.left=l-t.clientWidth/2+10+"px"};this.seekBar.addEventListener("touchmove",o),this.seekBar.addEventListener("mousemove",o);const s=()=>{setTimeout((()=>{t.style.display="none",n=!1}),100)};this.seekBar.addEventListener("mouseleave",s),this.seekBar.addEventListener("touchend",s)},this.initMountTargetEvent=()=>{d&&this.mountTarget.addEventListener("touchstart",this.setAutoHide),this.mountTarget.addEventListener("click",this.setAutoHide),this.mountTarget.addEventListener("mousemove",this.setAutoHide)},this.removeMountTargetEvent=()=>{},this.setAutoHide=()=>{this.show(),clearTimeout(this.autoHideTimer),this.autoHideTimer=setTimeout((()=>{!this.player.paused&&this.hide()}),2e3)},this.show=()=>{this.mountTarget.classList.remove("tp-hide-controller")},this.hide=()=>{this.mountTarget.classList.add("tp-hide-controller")},this.toggle=()=>{this.mountTarget.classList.contains("tp-hide-controller")?this.show():this.hide()},this.updateSeekBar=t=>{this.seekBar.value=((this.player.video.currentTime-this.player.clipStart)/this.player.duration*100).toString(),t||(this.playRaf=window.requestAnimationFrame((()=>this.updateSeekBar())))},this.onSeeking=t=>{t.preventDefault(),t.stopPropagation();const e=t.target,n=Number(parseFloat(e.value)/100*this.player.duration)+Number(this.player.clipStart);this.player.seek(n)},this.onSeeked=()=>{this.playRaf&&cancelAnimationFrame(this.playRaf),this.updateSeekBar(!0)},this.onTimeupdate=()=>{if(!this.playTime&&!this.controlOptions.manualMount)return;const t=+this.seekBar.value*this.player.duration*.01;this.playTime&&(this.playTime.textContent=`${c(t<0?0:t)} / ${c(this.player.duration)}`);const e=this.player.video.currentTime;!this.player.handleVideoEndByOuter&&this.player.clipEnd&&e>=this.player.clipEnd-.1&&(this.player.pause(),this.player.seek(Number(this.player.clipStart)),this.updateSeekBar(!0),this.player.options.loop&&this.player.play())},this.onVolumeChange=t=>{const e=t.target;this.player.volume(Number(e.value))},this.onWaiting=()=>{this.player.paused||(this.player.paused=!0),this.toggleLoading(!0)},this.onPlaying=()=>{this.player.paused&&(this.player.paused=!1),this.toggleLoading(!1)},this.switchVolumeIcon=()=>{this.controlOptions.volumeControl&&(this.player.video.muted||0===this.player.video.volume?this.muteButton.innerHTML=l:this.player.video.volume>0&&this.player.video.volume<1?this.muteButton.innerHTML=s:this.muteButton.innerHTML=o)},this.destroy=()=>{clearTimeout(this.autoHideTimer)},this.player=t,this.controlOptions=t.options.controlOptions||{},this.mountTarget=this.controlOptions.mountTarget||this.player.videoContainer,this.initControls(),this.initControlsEvent()}setVisible(t){t?this.show():this.hide()}toggleLoading(t){t?(this.loading.style.opacity="1",this.playButton.style.opacity="0"):(this.loading.style.opacity="0",this.playButton.style.opacity="1")}}var v,m;!function(t){t.audioprocess="audioprocess",t.canplay="canplay",t.canplaythrough="canplaythrough",t.complete="complete",t.durationchange="durationchange",t.emptied="emptied",t.ended="ended",t.loadeddata="loadeddata",t.loadedmetadata="loadedmetadata",t.pause="pause",t.play="play",t.playing="playing",t.progress="progress",t.ratechange="ratechange",t.seeked="seeked",t.seeking="seeking",t.stalled="stalled",t.suspend="suspend",t.timeupdate="timeupdate",t.volumechange="volumechange",t.waiting="waiting",t.error="error",t.abort="abort",t.loadstart="loadstart",t.mozaudioavailable="mozaudioavailable"}(v||(v={})),function(t){t.destroy="destroy",t.resize="resize",t.screenshot="screenshot"}(m||(m={}));class y{constructor(t){this.events={},this.player=t,this.videoEvents=Object.keys(v).map((t=>v[t])),this.playerEvents=Object.keys(m).map((t=>m[t]))}type(t){return-1!==this.playerEvents.indexOf(t)?"player":-1!==this.videoEvents.indexOf(t)?"video":(console.error(`${t} äº‹ä»¶ä¸å­˜åœ¨ï¼Œè¯·æŸ¥çœ‹ä¸‹æ–‡æ¡£`),null)}on(t,e){const n=this.type(t);if(n&&"function"!=typeof e)return console.error(`${t} äº‹ä»¶çš„å›è°ƒå‡½æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°`);this.events[t]||(this.events[t]=[]),this.events[t].push(e),"video"===n&&this.player.video.addEventListener(t,e),"player"===n&&this.events[t].push(e)}off(t,e){if(this.type(t)&&this.events[t]&&this.events[t].length){const n=this.events[t].indexOf(e);if(-1===n)return;this.events[t].splice(n,1),"video"===this.type(t)&&this.player.video.removeEventListener(t,e)}}emit(t,e){this.events[t]&&this.events[t].length&&this.events[t].forEach((t=>{t(e)}))}once(t,e){const n=(...i)=>{e(...i),this.off(t,n)};this.on(t,n)}}const{name:g,version:f}=e;console.log(`\n %c ${g} v${f} \n`,"color: white; font-size: 18px; background: linear-gradient(45deg, #ff0000 0%, #0092ff 80%);");class x{constructor(e){this.paused=!0,this.videoType="auto",this.duration=0,this.handleVideoEndByOuter=!1,this.onLoadedMetadata=()=>{this.duration=this.clipEnd-this.clipStart||this.video.duration,this.controller.onTimeupdate()},this.onPlay=()=>{this.paused=!1;const t=this.controller.playButton;t&&(t.innerHTML=i),this.controller.updateSeekBar()},this.onPause=()=>{this.paused=!0;const t=this.controller.playButton;t&&(t.innerHTML=n),cancelAnimationFrame(this.controller.playRaf)},this.play=()=>t(this,void 0,void 0,(function*(){yield this.video.play()})),this.pause=()=>t(this,void 0,void 0,(function*(){yield this.video.pause()})),this.togglePlay=e=>t(this,void 0,void 0,(function*(){this.video.paused?yield this.play():yield this.pause()})),this.seek=t=>{this.video.currentTime=Number(t)},this.mute=()=>{this.video.muted=!this.video.muted,this.controller.volumeSlider.value=this.video.muted?"0":this.video.volume+"",this.controller.muteButton.innerHTML=this.video.muted?l:o},this.toggleFullScreen=()=>{document.fullscreenElement?document.exitFullscreen():this.videoContainer.requestFullscreen()},this.handleWaterMarkShow=t=>{this.waterMark&&(this.waterMark.style.display=t?"block":"none")},this.mountController=t=>{this.options.controlOptions.nativeControls||(this.controller.removeMountTargetEvent(),this.controller.mountTarget=t,this.controller.initMountTargetEvent(),t.appendChild(this.controller.controlElement))},this.cutVideo=(t,e)=>{this.clipStart=t,this.clipEnd=e,this.duration=e-t,this.seek(t),this.controller.initTimeTip(),this.controller.updateSeekBar(!0)},this.destroy=()=>{this.pause(),this.video.src="",this.container.innerHTML="",this.controller.destroy()},this.container=e.container,this.options=e,this.clipStart=e.clipStart||0,this.clipEnd=e.clipEnd||0,this.handleVideoEndByOuter=e.handleVideoEndByOuter||!1,this.setup()}setup(){this.videoContainer=document.createElement("div"),this.videoContainer.className="tp-container",this.videoContainer.style.width=this.options.width||"100%",this.videoContainer.style.height=this.options.height||"100%",this.videoContainer.innerHTML=function(t,e,n,i){i=i||function(t,e,n,i,o){var s=e.split("\n"),l=Math.max(i-3,0),a=Math.min(s.length,i+3),r=o(n),p=s.slice(l,a).map((function(t,e){var n=e+l+1;return(n==i?" >> ":"    ")+n+"| "+t})).join("\n");throw t.path=r,t.message=(r||"ejs")+":"+i+"\n"+p+"\n\n"+t.message,t},e=e||function(t){return null==t?"":String(t).replace(s,l)};var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},s=/[&<>'"]/g;function l(t){return o[t]||t}var a=1;try{var r="";function p(t){null!=t&&(r+=t)}return p('\x3c!-- prettier-ignore --\x3e\n<video \n  class="tp-video"\n  crossorigin="anonymous"\n  webkit-playsinline\n  playsinline\n  src="'),a=7,p(e(t.src)),p('" \n  '),a=8,t?.controlOptions?.nativeControls&&p(" controls "),p(" \n  "),a=9,t.autoplay&&p(" autoplay "),p(" \n  "),a=10,t.muted&&p(" muted "),p(" \n  "),a=11,t.airplay&&p(" airplay "),p(" \n  "),a=12,t.airplay&&p(' x-webkit-airplay="allow" '),p(" \n  "),a=13,t.preload&&(p(' src="'),p(e(t.preload)),p('" ')),p(" \n  "),a=14,t.poster&&(p(' poster="'),p(e(t.poster)),p('" ')),p(" \n  "),a=15,t.volume&&(p(' src="'),p(e(t.volume)),p('" ')),p(" \n  "),a=16,t.playbackSpeed&&(p(' src="'),p(e(t.playbackSpeed)),p('" ')),p(" \n  "),a=17,t.anonymous&&(p(' src="'),p(e(t.anonymous)),p('" ')),p(' \n>\n  ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ï¼Œæ¢ä¸ªæµè§ˆå™¨è¯•è¯•ï¼Ÿ\n</video>\n\x3c!-- æ°´å° --\x3e\n<div class="tp-watermark" style="display: none"></div>\n'),a=23,r}catch(h){i(h,'\x3c!-- prettier-ignore --\x3e\n<video \n  class="tp-video"\n  crossorigin="anonymous"\n  webkit-playsinline\n  playsinline\n  src="<%= locals.src %>" \n  <% if(locals?.controlOptions?.nativeControls){ %> controls <% } %> \n  <% if(locals.autoplay){ %> autoplay <% } %> \n  <% if(locals.muted){ %> muted <% } %> \n  <% if(locals.airplay){ %> airplay <% } %> \n  <% if(locals.airplay){ %> x-webkit-airplay="allow" <% } %> \n  <% if(locals.preload){ %> src="<%= locals.preload %>" <% } %> \n  <% if(locals.poster){ %> poster="<%= locals.poster %>" <% } %> \n  <% if(locals.volume){ %> src="<%= locals.volume %>" <% } %> \n  <% if(locals.playbackSpeed){ %> src="<%= locals.playbackSpeed %>" <% } %> \n  <% if(locals.anonymous){ %> src="<%= locals.anonymous %>" <% } %> \n>\n  ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ï¼Œæ¢ä¸ªæµè§ˆå™¨è¯•è¯•ï¼Ÿ\n</video>\n\x3c!-- æ°´å° --\x3e\n<div class="tp-watermark" style="display: none"></div>\n',void 0,a,e)}}(this.options),this.container.innerHTML="",this.container.appendChild(this.videoContainer),this.video=this.videoContainer.querySelector("video"),this.waterMark=this.videoContainer.querySelector(".tp-watermark"),this.waterMark.style.backgroundImage=`url(${this.options.waterMarkUrl})`,this.events=new y(this),this.initVideo(),this.controller=new u(this),this.handleWaterMarkShow(this.options.waterMarkShow),this.seek(this.clipStart)}initVideo(){this.initMSE(this.video,this.options.type),this.on("play",this.onPlay),this.on("pause",this.onPause),this.on("ended",(()=>{this.clipEnd||(this.options.loop?(!this.paused&&this.seek(this.clipStart),this.play()):(!this.paused&&this.seek(this.clipStart),this.pause()),this.controller.updateSeekBar(!0))})),this.on("loadedmetadata",this.onLoadedMetadata)}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}emit(t,e){this.events.emit(t,e)}off(t,e){this.events.off(t,e)}initMSE(t,e){switch(this.videoType=e,"auto"===e&&(/m3u8(#|\?|$)/i.exec(t.src)&&(this.videoType="hls"),/.flv(#|\?|$)/i.exec(t.src)&&(this.videoType="flv"),/.mpd(#|\?|$)/i.exec(t.src)&&(this.videoType="dash"),this.videoType="normal"),this.videoType){case"flv":console.error("æš‚ä¸æ”¯æŒ flv æ ¼å¼è§†é¢‘");break;case"dash":console.error("æš‚ä¸æ”¯æŒ dash æ ¼å¼è§†é¢‘")}console.log(`ğŸš€ğŸš€ğŸš€ MSE: é¢„è®¾æ’­æ”¾æ¨¡å¼ï¼š${e},å®é™…æ’­æ”¾æ¨¡å¼ï¼š${this.videoType}, è§†é¢‘é“¾æ¥ï¼š${t.src}`)}volume(t){let e=parseFloat(t||0);return isNaN(e)||(e=Math.max(e,0),e=Math.min(e,1),this.video.volume=e,this.video.muted&&(this.video.muted=!1),this.controller.switchVolumeIcon()),this.video.volume}}x.title=g,x.version=f;export{x as default};
